<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>XLayer Gas Á©∫ÊäïÁî≥ËØ∑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.min.js";

    let signer, walletAddress, gasType = "XPL";

    //Èí±ÂåÖËøûÊé•
    async function connectWallet() {
      const providerDetected = window.ethereum || window.okxwallet || window.okx;
      if (!providerDetected) {
        alert("ËØ∑ÂÖàÂÆâË£Ö MetaMask Êàñ OKX Wallet Êèí‰ª∂„ÄÇ");
        return;
      }
      const provider = new ethers.BrowserProvider(providerDetected);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      walletAddress = await signer.getAddress();
      document.getElementById("connect-btn").textContent = `Â∑≤ËøûÊé•: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)} üîÑ`;

      // ÁõëÂê¨Ë¥¶Êà∑ÂàáÊç¢
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
          signer = null;
          walletAddress = null;
          document.getElementById("wallet-address").textContent = "Êú™ËøûÊé•";
          document.getElementById("connect-btn").textContent = "üîó ËøûÊé•Èí±ÂåÖ";
        } else {
          walletAddress = accounts[0];
          signer = provider.getSigner();
          //document.getElementById("wallet-address").textContent = walletAddress;
          document.getElementById("connect-btn").textContent = `Â∑≤ËøûÊé•: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)} üîÑ`;
        }
      });

      // ‰øÆÊîπÊåâÈíÆÊñáÂ≠óÔºåÊòæÁ§∫Èí±ÂåÖÂêçÁß∞ÊàñÂú∞ÂùÄÂâçÂêéÈÉ®ÂàÜ
      const btn = document.getElementById("connect-btn");
      btn.textContent = `Â∑≤ËøûÊé•: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
      btn.disabled = true; // ÂèØÈÄâÔºöËøûÊé•ÂêéÁ¶ÅÁî®ÊåâÈíÆÔºåÈò≤Ê≠¢ÈáçÂ§çÁÇπÂáª


    }

    //‰∏ªÊµÅÁ®ãÔºåÊèê‰∫§ÂèÇÊï∞
    async function submitTx() {
      const txHash = document.getElementById("txHash").value.trim();
      if (!txHash || !walletAddress) {
        alert("ËØ∑ËøûÊé•Èí±ÂåÖÂπ∂ËæìÂÖ•‰∫§ÊòìÂìàÂ∏å");
        return;
      }

      const overlay = document.getElementById("overlay");
      const controls = document.querySelectorAll("button, input, .gas-option");

      overlay.classList.add("active");
      controls.forEach(el => el.disabled = true);

      try {
        const response = await fetch("https://xuseless.netlify.app/.netlify/functions/verifyAndSubmit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ address: walletAddress, txHash, gasType }),
        });

        const result = await response.json();

        if (!response.ok) {
          alert(`Êèê‰∫§Â§±Ë¥• ‚ùå: ${result.error || "Êú™Áü•ÈîôËØØ"}`);
        } else {
          alert(`Êèê‰∫§ÊàêÂäü ‚úÖ: ${result.message}`);
          document.getElementById("txHash").value = "";
        }
      } catch (err) {
        console.error(err);
        alert("ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï");
      } finally {
        overlay.classList.remove("active");
        controls.forEach(el => el.disabled = false);
      }
    }

    //Á≤òË¥¥Âà∞‰∫§ÊòìÂìàÂ∏å
    async function pasteHash() {
      const input = document.getElementById('txHash');
      if (!navigator.clipboard) {
        alert('ÂΩìÂâçÁéØÂ¢É‰∏çÊîØÊåÅËá™Âä®Á≤òË¥¥ÔºåËØ∑‰ΩøÁî® Ctrl+V ÊâãÂä®Á≤òË¥¥');
        return;
      }
      try {
        const text = await navigator.clipboard.readText();
        if (!text) {
          alert('Ââ™Ë¥¥Êùø‰∏≠Ê≤°ÊúâÂÜÖÂÆπ');
          return;
        }
        input.value = text;
      } catch (err) {
        console.error(err);
        alert('ËØªÂèñÂâ™Ë¥¥ÊùøÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊùÉÈôêÔºàÈúÄHTTPSÊàñlocalhostÔºâ');
      }
    }

    // ÂèëÊîæÁ©∫ÊäïÁöÑÈí±ÂåÖÂú∞ÂùÄÔºà‰Ω†Ëá™Â∑±ÁöÑÔºâ
    const AIRDROP_WALLETS = {
      ETH: "0x592f51828160981dcece6b491c0fc68825d92249",
      BASE_ETH: "0x592f51828160981dcece6b491c0fc68825d92249",
      BNB: "0x592f51828160981dcece6b491c0fc68825d92249",
      XPL: "0x592f51828160981dcece6b491c0fc68825d92249"
    };

    // ÂØπÂ∫îÁöÑ RPC ËäÇÁÇπ
    const RPC_ENDPOINTS = {
      ETH: "https://ethereum.publicnode.com",
      BASE_ETH: "https://mainnet.base.org",
      BNB: "https://bsc-dataseed.binance.org/",
      XPL: "https://rpc.plasma.to",
      OKB: "https://xlayerrpc.okx.com"
    };

    // Êõ¥Êñ∞ÂèëÊîæÈí±ÂåÖ‰ΩôÈ¢ù
    async function updateAirdropBalance() {
      const targetAddress = AIRDROP_WALLETS[gasType];
      const rpcUrl = RPC_ENDPOINTS[gasType];

      if (!targetAddress || !rpcUrl) {
        document.getElementById("wallet-balance").textContent = "Êú™Áü•ÁΩëÁªú";
        return;
      }

      try {
        const provider = new ethers.JsonRpcProvider(rpcUrl);
        const balance = await provider.getBalance(targetAddress);

        const formatted = Number(ethers.formatEther(balance)).toFixed(4);
        document.getElementById("wallet-balance").textContent = formatted;

        // ÂÅáËÆæÊØè‰∫∫Á©∫ÊäïÂõ∫ÂÆö 0.000025 Âçï‰Ωç GasÔºå‰º∞ÁÆóÂèØÂèëÊîæÊ¨°Êï∞
        const estimate = Math.floor(Number(formatted) / 0.000025);
        document.getElementById("estimated-dispense").textContent = estimate;

      } catch (err) {
        console.error("Êü•ËØ¢ÂèëÊîæÈí±ÂåÖ‰ΩôÈ¢ùÂ§±Ë¥•:", err);
        document.getElementById("wallet-balance").textContent = "ÈîôËØØ";
      }
    }

    // Ëá™Âä®Êõ¥Êñ∞Á©∫ÊäïÈí±ÂåÖ‰ΩôÈ¢ù
    async function selectGasType(value) {
      gasType = value;
      document.querySelectorAll(".gas-option").forEach(el => el.classList.remove("selected"));
      const current = document.getElementById("opt-" + value);
      if (current) current.classList.add("selected");

      await updateAirdropBalance();
    }

    // üîπ ÁªëÂÆö‚ÄúÁÇπÂáªË¥≠‰π∞‚ÄùÈìæÊé•ÈÄªËæë
    document.getElementById("buyLink").addEventListener("click", function (e) {
      e.preventDefault();

      // XUSELESS ÂêàÁ∫¶Âú® XLayer ÁöÑ OKX ‰∫§ÊòìÈìæÊé•
      const okxWebUrl = "https://web3.okx.com/zh-hans/token/x-layer/0x6375d4ed218f7c0ec7e8245ba368206eef5d5b02";
      const okxAppUrl = "okx://web3/dex-swap/xlayer/0x6375d4ed218f7c0ec7e8245ba368206eef5d5b02";

      const ua = navigator.userAgent.toLowerCase();
      const isMobile = /android|iphone|ipad|ipod/.test(ua);

      if (isMobile) {
        // ‚úÖ ÊâãÊú∫Á´Ø ‚Üí Áõ¥Êé•Â∞ùËØïÊâìÂºÄ OKX App
        window.location.href = okxAppUrl;
        // ‚è≥ Â¶ÇÊûúÁî®Êà∑Ê≤°Ë£Ö AppÔºåÂèØ‰ª•Âú®Âá†ÁßíÂêéËá™Âä®ÂõûÈÄÄÂà∞ÁΩëÈ°µÁ´Ø
        setTimeout(() => {
          window.location.href = okxWebUrl;
        }, 2000);
      } else {
        // ‚úÖ Ê°åÈù¢Á´Ø ‚Üí ÊâìÂºÄ Web3 ÁΩëÈ°µÁâà‰∫§ÊòìÁïåÈù¢
        window.open(okxWebUrl, "_blank");
      }
    });


    // üîπ ÊåÇËΩΩÂà∞ÂÖ®Â±ÄÔºåHTML onclick Ë∞ÉÁî®
    window.connectWallet = connectWallet;
    window.selectGasType = selectGasType;
    window.submitTx = submitTx;
    window.pasteHash = pasteHash;
    window.addEventListener("load", async () => {
      await selectGasType(gasType); // ÈªòËÆ§ÈÄâ‰∏≠ XPL
    });
  </script>



  <style>
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: #fafafa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    .card {
      background: #fff;
      padding: 20px 30px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 480px;
    }
    button {
      background-color: #4a90e2;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 10px;
    }
    button:hover {
      background-color: #357ABD;
    }
    input {
      width: 100%;
       box-sizing: border-box;
      padding: 10px 40px 10px 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .wallet-box {
      margin-bottom: 15px;
      display: flex; 
      justify-content: flex-end;
    }
    .gas-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
      justify-content: space-between;
    }
    .gas-option {
      flex: 0 1 calc(33.333% - 10px);
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 12px;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    .gas-option:hover {
      background: #f3f7ff;
      border-color: #4a90e2;
    }
    .gas-option.selected {
      background: #e6f0ff;
      border-color: #4a90e2;
      color: #1a4ea3;
      font-weight: bold;
    }
    .single-btn {
      width: 100%;
    }
    .input-wrapper {
      position: relative;
      width: 100%;
    }

    .paste-btn {
      position: absolute;
      right: 3px;
      top: 50%;
      transform: translateY(-50%);
      background-color: #4a90e2;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      margin-top: 0px;
    }

    label {
      display: block;
      margin-top: 8px;
      margin-bottom: 8px; /* ÊéßÂà∂ label ‰∏é‰∏ãÊñπÂÖÉÁ¥†Èó¥Ë∑ù */
      font-weight: 500;
    }
    #overlay {
      display: none; /* ÂàùÂßãÈöêËóè */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      z-index: 1000;
      backdrop-filter: blur(2px);
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    #overlay.active {
      display: flex; /* ÁÇπÂáªÊèê‰∫§Êó∂ÊòæÁ§∫ */
    }

  </style>
</head>

<body>
  <div class="card">
    <h2>üöÄ Xuseless Gas Á©∫Êäï</h2>
    <p>ËØ∑Á°ÆËÆ§‰Ω†Âú® dex Ë¥≠‰π∞‰∫Ü10000Êûö‰ª•‰∏äXUSELESSÂêéÔºåÊèê‰∫§‰∫§ÊòìÂìàÂ∏åÔºågasÂ∞ÜÂú®5~10ÂàÜÈíüÂÜÖÂèëÊîæ„ÄÇ
      <a href="#" id="buyLink" style="
        color:#4a90e2; 
        font-weight:bold; 
        text-decoration:none; 
        margin-left:6px;">ÁÇπÂáªË¥≠‰π∞</a>
    </p>

    <div class="wallet-box">
      <button id="connect-btn" onclick="connectWallet()">üîó ËøûÊé•Èí±ÂåÖ</button>
    </div>

    <label for="txHash">‰∫§ÊòìÂìàÂ∏åÔºö</label>
    <div class="input-wrapper">
      <input id="txHash" type="text" placeholder="ËØ∑ËæìÂÖ•‰∫§ÊòìÂìàÂ∏å">
      <button class="paste-btn" onclick="pasteHash()">Á≤òË¥¥</button>
    </div>

    <label>ÈÄâÊã©Á©∫ÊäïÁöÑ Gas Á±ªÂûãÔºö</label>
    <div class="gas-options">
      <div id="opt-BASE_ETH" class="gas-option" onclick="selectGasType('BASE_ETH')">Base ETH</div>
      <div id="opt-BNB" class="gas-option" onclick="selectGasType('BNB')">BNB</div>
      <div id="opt-XPL" class="gas-option" onclick="selectGasType('XPL')">XPL</div>
    </div>
    <p>Ââ©‰Ωô Gas: <span id="wallet-balance">0</span></p>
    <p>È¢ÑËÆ°ÂèØÂèëÊîæÊ¨°Êï∞: <span id="estimated-dispense">0</span></p>
    <button class="single-btn" onclick="submitTx()">üì§ Êèê‰∫§Áî≥ËØ∑</button>
  </div>
  <div id="overlay">
    Êèê‰∫§‰∏≠ÔºåËØ∑Á®çÂÄô...
  </div>



</body>
</html>
